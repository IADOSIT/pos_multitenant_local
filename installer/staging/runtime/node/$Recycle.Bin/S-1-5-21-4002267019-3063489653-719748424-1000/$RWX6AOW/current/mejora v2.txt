PROMPT PARA CLAUDE CODE (CRUDes + Livewire 3 + Mary UI)

Trabaja en el repo:

C:\sites\emc_abastos\current

PHP: C:\php\php.exe

Postgres: pgsql

Tu misión: completar el sistema al 100% como SaaS multitenant empresarial y dejar Admin/Ops bonito y reactivo con Livewire 3 + Mary UI (gratis).
NO entregues nada “a medias”: cada bloque debe quedar funcional, con rutas, permisos, validaciones y vistas.

1) Decisión técnica (obligatoria)
Stack UI (Admin/Ops)

Livewire 3

Mary UI (gratis, basado en DaisyUI + Livewire)

Tailwind compilado con Vite (NO CDN)

Si detectas ya Tailwind CDN en layouts, elimínalo y deja Vite/Tailwind compilado.

Organización

Admin: componentes Livewire en app/Livewire/Admin/...

Ops: componentes Livewire en app/Livewire/Ops/...

Layouts en resources/views/layouts/ (Blade)

Mary UI layout base + sidebar + topbar + breadcrumbs.

2) Multi-tenant (no lo rompas)

Tenant = empresa.

Session: session('empresa_id') (ya existe middleware empresa)

Todos los CRUDs deben filtrar por empresa_id donde aplique.

Superadmin puede ver/editar todo.

Admin empresa ve su tenant.

Roles requeridos:

superadmin

admin_empresa

operaciones

cajero

repartidor

Importante: pivote empresa_usuario: verifica si rol_id es requerido.
Si lo es, en todo attach/insert asigna rol correcto.

3) Objetivo inmediato: que el sistema no truene

Antes de CRUDes:

Arregla StoreController.php (BOM/namespace) si aún aparece fatal error.

Asegura rutas:

store.index, store.home, login, logout, dashboard, admin.dashboard

Login redirige bien:

si superadmin o admin_empresa => admin.dashboard

si operaciones => ops.hub (o ops.ordenes.index)

si repartidor => ops.repartidores.index o vista repartidor

Logout redirige a store.home

4) CRUDes faltantes (hacerlos TODOS)
4.1 CRUD Empresas (superadmin)

Entidad: Empresa

listar, crear, editar, eliminar (soft delete si es viable)

campos sugeridos:

nombre, slug, status(activo), contacto, whatsapp, email

settings JSON (impuestos, envío, WhatsApp provider config)

Multi-tenant: superadmin ve todas; admin_empresa NO debe editar empresa global, solo su empresa si se permite.

UI: Livewire + Mary UI con:

tabla con búsqueda, filtros (activo/inactivo)

modal create/edit

confirm delete

Rutas:

admin.empresas.*

4.2 CRUD Categorías (por empresa)

campos: empresa_id, nombre, slug, orden, activo

validación unique por empresa (empresa_id + slug o empresa_id + nombre)

UI Livewire tabla + modal create/edit
Rutas:

admin.categorias.*

4.3 CRUD Productos (por empresa) COMPLETO

crear/editar/eliminar

sku, nombre, descripcion, precio, activo, categoria_id, meta JSON

imágenes:

subir imagen principal (Storage local)

preview en tabla

validaciones:

categoria debe pertenecer a misma empresa

activo boolean correcto (hidden 0 + checkbox 1)
Rutas:

admin.productos.*

4.4 CRUD Usuarios / Roles (SaaS)

superadmin:

crea usuarios

asigna a empresas con rol y status

admin_empresa:

puede invitar/crear usuarios para SU empresa y asignar roles permitidos

UI Livewire:

listado usuarios de empresa

modal: attach usuario existente por email

modal: crear usuario rápido + attach con rol

asegurar autopopulate ya existente (/ops/lookups/usuarios) si aplica, o reemplazar por Livewire search.

Rutas:

admin.usuarios.*

admin.roles.* (si necesitas UI simple para roles)

5) Migrar Admin/Ops a Livewire (sin reescribir Storefront aún)

Mantén Storefront en Blade normal si ya funciona.
Pero Admin y Ops deben pasar a Livewire:

Admin Dashboard

métricas reales sin usar modelos inexistentes (ej. no Cliente si no existe)

links deben existir (no rutas fantasmas)

widgets:

órdenes del día

ventas (sum pagos)

productos activos

inventario bajo (si hay stock)

Ops Órdenes

Livewire table con filtros por status y fecha

detalle: ya existen vistas; puedes mantener Blade para show pero lista debe ser Livewire.

6) Mary UI (instalación + estándares)

Instala Mary UI y configura:

DaisyUI + Tailwind

componentes:

<x-card>, <x-button>, <x-input>, <x-table>, <x-modal> o equivalentes Mary

layout:

sidebar con secciones: Admin (Empresas/Categorías/Productos/Usuarios) + Ops (Órdenes/Entregas/Pagos/Caja/Inventario/WhatsApp/Repartidores)

dark mode opcional.

Deja un README_DEV.md con pasos exactos:

instalar deps

compilar assets

migrar

seed demo

correr server

7) Seeds demo (para que se vea bonito y usable)

Crea seeders reales en database/seeders:

RolesSeeder

EmpresasSeeder (2 empresas)

UsersSeeder (superadmin + admin_empresa + operaciones + cajero + repartidor)

CategoriasSeeder

ProductosSeeder (10-20 por empresa)

InventarioSeeder (ledger inicial)

OrdenesSeeder (3-5 órdenes con items + pagos + entrega)

CajaSeeder (turno + movimientos)

WhatsappLogsSeeder (algunos logs)

Incluye un script windows:

scripts/windows/SEED_DEMO.ps1

corre php artisan migrate --force

corre php artisan db:seed --force

corre php artisan optimize:clear

8) Scripts Windows (cero errores PowerShell)

Todo script debe:

usar comillas ASCII (no “ ”)

usar Set-StrictMode -Version Latest

evitar variables no definidas

-LiteralPath en paths

funciones Replace-InFile seguras

Entregables scripts:

scripts/windows/INSTALL_LIVEWIRE_MARY.ps1

scripts/windows/APPLY_ADMIN_OPS_LIVEWIRE.ps1

scripts/windows/SEED_DEMO.ps1

scripts/windows/RESET_DEMO.ps1

9) Criterio de éxito (no negociable)

Al final debe funcionar:

php artisan route:list sin fatal errors

/login funciona

login redirige correctamente según rol

/admin carga dashboard Livewire (bonito)

CRUD Empresas funciona (superadmin)

CRUD Categorías/Productos funciona por empresa

CRUD Usuarios/roles funciona por empresa

Ops Órdenes lista funciona

10) Modo entrega (cómo quiero que respondas)

No me des explicación larga: entrégame:

lista de archivos tocados

comandos a correr

scripts creados

nota rápida de verificación (“abre /admin/empresas y crea una empresa”)
