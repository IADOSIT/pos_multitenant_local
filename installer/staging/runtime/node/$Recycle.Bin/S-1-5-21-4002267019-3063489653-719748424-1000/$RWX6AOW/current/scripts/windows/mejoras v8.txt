PROMPT PARA CLAUDE CODE
EMC ‚Äì V7.x Ajuste Empresas ‚Üí Auto-Tienda + Tel/RRSS + Fuera de Servicio

Eres Claude Code y YA conoces completamente el repositorio emc_abastos (Laravel) y la estructura actual (Admin/Ops/Portal/Tiendas, multi-empresa, scoping por empresa, plantillas/temas, WhatsApp, im√°genes, etc.).
‚ö†Ô∏è NO reanalices el proyecto, NO listes archivos, NO hagas preguntas.
‚úÖ Implementa de forma √≥ptima y con mejores pr√°cticas, sin romper funcionalidades existentes.

üéØ Objetivo

En Admin ‚Üí Empresas, agregar campos:

telefono_empresa

redes_sociales (JSON o campos separados; elige lo m√°s √≥ptimo)

Al crear una Empresa, el sistema debe crear autom√°ticamente una Tienda (Store) ligada a esa Empresa y todo debe quedar relacionado a esa tienda/empresa: productos, usuarios, ventas/√≥rdenes, pagos, inventario, WhatsApp, etc.

Reutilizar la ‚Äútienda EMC‚Äù existente como base (no reinventar).

Integrar configuraci√≥n de empresa (plantilla/tema, nombre, estilo) para la tienda creada.

Si la empresa se desactiva:

la tienda debe mostrar ‚ÄúP√°gina Fuera de Servicio‚Äù

ocultar cat√°logo/productos (no deben mostrarse)

En la tienda (footer) mostrar:

Tel√©fono de empresa

Redes sociales

1) Admin ‚Üí Empresas: nuevos campos
1.1 Migraci√≥n/Modelo

Agrega a empresas:

telefono (string, nullable)

redes_sociales (JSON nullable) recomendado con llaves: facebook, instagram, tiktok, x, youtube, web, whatsapp

A√±ade casts en el modelo Empresa para redes_sociales.

1.2 Form UI (crear/editar empresa)

En Admin ‚Üí Empresa:

input Tel√©fono

inputs redes (o un editor simple que mapee al JSON)

Validaciones:

tel√©fono: formato flexible (solo limpiar espacios/guiones)

redes: URLs v√°lidas cuando aplique

2) Auto-creaci√≥n de Tienda al crear Empresa (CR√çTICO)
2.1 Regla

Cuando se crea una Empresa (o se activa por primera vez si ya exist√≠a sin tienda):

Crear autom√°ticamente un registro de Tienda/Store (o entidad equivalente que ya exista) asociado a empresa_id.

La tienda debe heredar:

nombre visible (empresa.nombre)

plantilla/tema (de la configuraci√≥n de empresa en admin)

branding b√°sico (colores, logo si existe)

estado activo/inactivo

2.2 Implementaci√≥n (mejor pr√°ctica)

En lugar de l√≥gica en controlador, usar:

Observer: EmpresaObserver@created

o Service: EmpresaProvisioningService::createStoreForEmpresa($empresa)

Debe ser idempotente:

si ya existe tienda para esa empresa, no duplicar.

2.3 Relaci√≥n total

Asegurar que el ‚Äúscoping‚Äù del sistema quede consistente:

Tienda/Store tiene empresa_id

Todo lo existente que ya filtra por empresa_id sigue igual (NO reescribir todo).

Donde aplique tienda por dominio/handle, la resoluci√≥n final debe apuntar a empresa activa.

3) Tienda: integrar configuraci√≥n de Empresa (tema/plantilla/nombre)

La tienda debe usar el tema/plantilla definido en Admin ‚Üí Empresa (ya existente).

Si la empresa cambia plantilla/nombre/branding, la tienda refleja el cambio (directo o por sync ligero).

No crear un sistema nuevo: reutiliza el actual de temas/plantillas/config.

4) Empresa desactivada ‚Üí ‚ÄúP√°gina Fuera de Servicio‚Äù
4.1 Comportamiento obligatorio en storefront

Si empresa.activa = false (o campo equivalente):

En la tienda:

Mostrar t√≠tulo ‚ÄúP√°gina Fuera de Servicio‚Äù

Ocultar completamente:

listados de productos

detalle de producto

carrito/checkout (si aplica)

Devolver 200 con vista informativa (o 503 si ya manejan status; elige lo m√°s seguro sin romper SEO/rutas).

4.2 Implementaci√≥n

Middleware EnsureEmpresaActivaForStorefront

si inactiva ‚Üí render ‚Äúfuera de servicio‚Äù

Tambi√©n debe afectar endpoints p√∫blicos del storefront si existen.

5) Footer de la tienda: Tel√©fono + Redes

En la vista base/layout de tienda:

Mostrar:

Tel√©fono de empresa

Links a redes sociales (solo las que existan)

Mantener ‚ÄúDesarrollado por iados.mx‚Äù si ya existe en el portal/tienda (no romper).

6) Entregables

Migraci√≥n + modelo Empresa (telefono + redes JSON)

UI Admin Empresas (crear/editar) para capturar Tel/RRSS

Auto-creaci√≥n de tienda al crear empresa (idempotente)

Tienda hereda tema/plantilla/nombre de empresa

Middleware ‚ÄúFuera de servicio‚Äù al desactivar empresa + ocultar cat√°logo

Footer de tienda con Tel/RRSS

Seeds m√≠nimos (opcional): empresas con tel/redes para ver el footer funcionando

‚úÖ Reglas finales

NO preguntas.

NO reanalizar repo.

Reutilizar componentes y servicios existentes.

Sin regresiones: productos/√≥rdenes/pagos/inventario deben seguir operando bajo empresa.

INICIA implementando migraci√≥n + admin form + provisioning autom√°tico de tienda + middleware fuera de servicio + footer Tel/RRSS.